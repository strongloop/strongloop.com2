---
id: 25505
title: Build Real-Time Node.js Apps with Angular LiveSet and LoopBack
date: 2015-07-15T08:59:13+00:00
author: Ritchie Martori
guid: https://strongloop.com/?p=25505
permalink: /strongblog/build-real-time-apps-with-angular-liveset-and-loopback/
categories:
  - JavaScript Language
  - LoopBack
---
## **What is LiveSet?**

[LiveSet](https://github.com/strongloop/angular-live-set) is an AngularJS module that makes it easy to build real time applications. We created it so you can focus on building your app instead of cobbling together several libraries and frameworks. Unlike other real-time libraries and frameworks, we didn’t build LiveSet on top of our own proprietary protocols and transports. Instead we used the [HTML5 EventSource Web API](https://developer.mozilla.org/en-US/docs/Web/API/EventSource). This means you aren&#8217;t locked into our client or server and can use existing tooling (for example, Chrome&#8217;s EventStream tab&#8211;see below).

<img class="aligncenter size-full wp-image-25517" src="{{site.url}}/blog-assets/2015/07/r1.png" alt="r1" width="975" height="398"  />

Below is screen recording of [several basic LiveSet examples](https://github.com/strongloop/angular-live-set-example). These examples illustrate just how much you can accomplish with LiveSet and LoopBack in 10-20 lines of JavaScript.

<img class="aligncenter size-full wp-image-25531" src="{{site.url}}/blog-assets/2015/07/gif.gif" alt="gif" width="704" height="924" />

&nbsp;

## **The LiveSet API**

The LiveSet module includes two factories you can inject into your AngularJS controllers and services.

**createChangeStream(src)**

This function returns a [ChangeStream](https://github.com/strongloop/angular-live-set#changestreameventsource), which extends the [Node.js PassThrough stream](https://nodejs.org/api/stream.html#stream_class_stream_passthrough) with some basic JSON parsing support. When you provide a src argument (an [EventSource](https://developer.mozilla.org/en-US/docs/Web/API/EventSource)), the stream will add event listeners to it and write data from the **EventSource** to the stream.

**LiveSet(data, changes, options)**

This is the [LiveSet](https://github.com/strongloop/angular-live-set#livesetdata-changes-options) constructor. It requires an array of initial data, and a\`ChangeStream\`.

## **Let&#8217;s see the code!**

**Favorite Colors**

<img class="aligncenter size-full wp-image-25518" src="{{site.url}}/blog-assets/2015/07/r2.png" alt="r2" width="687" height="653"  />

This is a snippet from the [colors example](https://github.com/strongloop/angular-live-set-example/blob/master/client/modules/color/color-list.controller.js) that demonstrates creating a basic **LiveSet** and wiring it to an EventSource. The **Color** service is generated by the [loopback-angular-sdk](http://docs.strongloop.com/display/LB/AngularJS+JavaScript+SDK).

```js
var src = new EventSource('/api/colors/change-stream');
var changes = createChangeStream(src);
var set;

Color.find().$promise.then(function(results) {
  set = new LiveSet(results, changes);
  $scope.colors = set.toLiveArray();
});
```

Changes made using the **Color** service will be pushed to other clients listening on the same change-stream.

**Live Draw**

<img class="aligncenter size-full wp-image-25519" src="{{site.url}}/blog-assets/2015/07/r4.png" alt="r4" width="581" height="535"  />

The drawing example creates a **LiveSet** in a similar way. The draw method uses a service provided by the [loopback-angular-sdk](http://docs.strongloop.com/display/LB/AngularJS+JavaScript+SDK) to create additional points in the drawing. This data is streamed to other browser clients.

```js
$scope.draw = function(e) {
  if($scope.drawing) {
    Circle.create({
      x: e.offsetX,
      y: e.offsetY,
      r: Math.floor(10 * Math.random())
    });
  }
}
```

**Streaming Chart**

<img class="aligncenter size-full wp-image-25520" src="{{site.url}}/blog-assets/2015/07/r5.png" alt="r5" width="692" height="645"  />

The streaming chart does not use the **LiveSet** class at all. It demonstrates how to stream arbitrary JSON data to browser clients.

```js
var src = new EventSource('/api/process/memory');
var changes = createChangeStream(src);

changes.on('data', function(update) {
  // add the new data to the chart
});
```

See the entire chart example code in the [Angular LiveSet example](https://github.com/strongloop/angular-live-set-example/tree/master/client/modules/chart).

## **Server-sent events**

LiveSet uses [HTML5’s EventSource web API](https://developer.mozilla.org/en-US/docs/Web/API/EventSource) to accept data pushed from the server (server-sent events). Other similar libraries and frameworks use WebSockets or HTTP long polling (among other strategies). **LiveSet** does not require HTTP requests to be upgraded to WebSockets, which means it is compatible with load balancers and proxies that don’t support WebSockets. It also means most modern browsers (see below) can receive data natively instead of requiring a large JavaScript dependency.

To send changes to objects in your **LiveSet** from your server, your server should support sending a \`ChangeStream\` using the EventSource protocol. [LoopBack](http://loopback.io), the Node.js API framework, supports this natively. You can see an implementation with the **/my-data/change-stream** route in the example code.

[Most browsers](http://caniuse.com/#feat=eventsource) natively support EventSource and Server-sent events. For IE and other browsers that do not support it natively, you can use one of [several polyfills](http://bower.io/search/?q=eventsource%20polyfill).

## **Creating the Favorite Colors Example**

Here is a basic tutorial that walks you through creating a simple AngularJS application using LiveSet. It assumes you are aware of setting up a basic angular application and its dependencies.

## **Step 1: Dependencies**

You will need the following Node modules. Take a look at their getting started guides and READMEs if you are not familiar with setting them up:

  * [strongloop](http://loopback.io) (installed globally). This gives you the slc command-line tool, the Arc GUI, and the [LoopBack Angular SDK](http://docs.strongloop.com/display/LB/AngularJS+JavaScript+SDK).
  * [gulp](http://gulp.js)
  * [gulp-loopback-angular](http://gulp-loopback-angular) (the Grunt version would work as well)

Also the following Bower packages:

  * [angular](http://angular.js)
  * [angular-resource](https://github.com/angular/bower-angular-resource)
  * [angular-live-set](https://github.com/strongloop/angular-live-set)

First you will need a basic AngularJS application running in a browser including the dependencies mentioned above. In the next steps I’ll walk through using the \`lbServices\` and LiveSet modules to build the application.

## **Step 2: The API**

The Favorite Colors example was created first by running \`slc loopback\` to scaffold a LoopBack API server. If you are unfamiliar with creating LoopBack apps read more about it [on the LoopBack site](http://loopback.io).

**Using the slc CLI tool**

Once you have the LoopBack API scaffolded, you can add a model. All we need for this app is a basic Color model.

```js
slc loopback:model
```

Follow the CLI instructions and create the property “val&#8221;. Select “string&#8221; for the type. Add another property named “votes&#8221;. This should be a “number&#8221;.

**Using the StrongLoop Arc UI**

Alternatively, you can use StrongLoop’s Arc to create the model. Arc is a fully featured UI that allows you to compose APIs very quickly (as well as [many other cool things](https://strongloop.com/node-js/arc/)). Open it by running:

```js
slc arc
```

Click on the Composer icon and create your model. See the screenshot for the exact settings. Make sure you select db for the Data source and create two properties. val which is a string and votes which is a number.

<img class="aligncenter size-full wp-image-25521" src="{{site.url}}/blog-assets/2015/07/r6.png" alt="r6" width="975" height="511"  />

**The Color service**

Generate your lb-services.js angular module using the [loopback-angular-sdk](http://gulp-loopback-angular). This will give you access to the Color resource in your angular app. Make sure you include the script tag and register the module as an angular dependency for the lbServices module (generated by loopback-angular-sdk). You also must include the source for the ngResource module (which you should have installed as part of step 1).

## **Step 3: The Controller**

Now that you have a Color model API and the angular-live-set module available from your angular app, you can create a simple controller for interacting with the Color data. Start with a simple template that renders an array of color objects. [I&#8217;ll assume you know how to do this](http://plnkr.co/edit/?p=preview). The template should look a bit like this:

```js
<div ng-controller="ColorCtrl">
  <div ng-repeat="color in colors">
    <button
      ng-click="upvote(color.id)"
      style="background: {{ color.val }}">{{ color.votes }}</button>
  </div>
</div>
```

Within our controller we need to create a LiveSet of colors as well as implement the \`createColor()\` and \`upvote()\` methods. It should look something like this:

```js
function ColorCtrl($scope, createChangeStream, LiveSet, Color) {
  $scope.upvote = function(id) {
    Color.upvote({id: id});
  }

  $scope.newColor = 'red';

  $scope.createColor = function() {
    Color.create({val: $scope.newColor, votes: 0});
  }
}
```

And in our model source code we need to add the upvote method:

```js
Color.upvote = function(id, cb) {
  Color.findById(id, function(err, color) {
    if(err) return cb(err);
    color.votes += 1;
    color.save(cb);
  });
};

Color.remoteMethod('upvote', {
  isStatic: true,
  accepts: {arg: 'id', type: 'number'}
});
```

## **Step 4: The LiveSet**

The last step is to add the actual live set.

```js
// this should be added to our controller
var changeStreamUrl = '/api/colors/subscription?_format=event-source';
var src = new EventSource(changeStreamUrl);
var changes = createChangeStream(src);
var set;

Color.find().$promise.then(function(colors) {
  set = new LiveSet(colors, changes);
  $scope.colors = set.toLiveArray();
});
```

The code above creates a LiveSet from a \`ChangeStream\`. The LiveSet is a read only collection of data. The items in the set will be updated as changes are written to the \`ChangeStream\`.  Since the change stream was created with an \`EventSource\` the changes will be written from the server as they are made. This will keep the data in the LiveSet up to date.

Also, the LiveSet will make sure that changes are applied to the \`$scope\`. This means often you can create a LiveSet as a view of the data and use the model API (eg. Color) to modify the data. Once the change has been made on the server, the change will be made to your LiveSet.

## **Now it&#8217;s your turn!**

Now that you’ve learned what LiveSet is and how to build your first LiveSet app [take a deeper look at the code](https://github.com/strongloop/angular-live-set) or [browse the API](https://github.com/strongloop/angular-live-set#api), and don’t forget to [star it on github &#8211;>](https://github.com/strongloop/angular-live-set)